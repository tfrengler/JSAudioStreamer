"use strict";

// const backendEntryPoint = "CFCs/AjaxProxy.cfc";

import * as EventScope from "./EventManager.js";
import { MediaController } from "./MediaController.js";
import { ServiceLocator } from "./ServiceLocator.js";
import { UI_Controller } from "./UI_Controller.js";
import { PlayList } from "./Playlist.js";
import { IndexManager } from "./IndexManager.js";

const Services = new ServiceLocator();

const Events = Object.create(null);
Events.manager = new EventScope.EventManager();
Events.types = EventScope.EventTypes;
Services.provide("events", Events);

const Indexes = new IndexManager();
Services.provide("indexes", Indexes);

const Playlist = new PlayList(Services);
Services.provide("playlist", Playlist);

const Player = new MediaController(Services);
Services.provide("player", Player);

const UIController = new UI_Controller(Services);
Services.lock();

const loadMusicIndex = function() {
	var ClientIndex;
	var BackendIndex;

	fetch("Data/ClientIndex.json", {cache: "no-store", mode: "same-origin", method: "GET", redirect: "error"})
	.then(response=> response.json())
	.then(jsonResponse=> {
		
		ClientIndex = jsonResponse;
		return fetch("Data/BackendIndex.json", {cache: "no-store", mode: "same-origin", method: "GET", redirect: "error"});
	})
	.then(response=> response.json())
	.then(jsonResponse=> {
		
		BackendIndex = jsonResponse;
		Indexes.buildIndexes(ClientIndex, BackendIndex);

		UIController._createLibraryList(Indexes.getCollection());
	});
}

// Debug mode, expose the stuff to the user so we can access stuff via the console
if (window.location.href.indexOf("?DevMode=1") > -1) {
	window.main = Object.seal({
		services: Services,
		events: Events,
		indexes: Indexes,
		playlist: Playlist,
		player: Player,
		uiController: UIController
	})
}

// Object.freeze(main);

window.onload = () => {
	UIController.init();
	loadMusicIndex();

	console.warn("Everything is initialized and ready to rock and roll");
}


window.testdata= {
"N/A": {
	"Greatest Julehits 97": [
	"B4D9AAF61EBB7D4F70063296FD8DB6152867D2F09672E59B873F4D9F5FAF4E33",
	"978DBF40CFB253DB6717EFC9D232AF985DE81D90CBC68ADC7E51D722B11E1ACC",
	"495A355ED4D620BE4E880C1EBBF206E55700092DFF6C5D0D46E1DE4232B3A8AF",
	"13D547B8DB4E14642E4BE2D775EAADDD2F08E003ABF2EB5F3D391C7F527D5337",
	"33115436E3986C588DAB4E7D58A381616373A0557FFE8A9658A4AA4E25783108",
	"E1D595AD2D50E9A0FFC7C32325A437522F9EB3604AA7C0317E4EB57FC47F7EC7",
	"424E707A007A52B27F3AC83107A11AE17A2F4DF1EC58A2626D927FE0663D5C15",
	"62016A1BB71D31CF072BC3AC05DBC4551E63A89A1EAAEDE8A30DCA83FAE7D80D",
	"145843471D07CA7E74F95A00A092DD6C67027F603EE24204374A293BEC131843",
	"1C3B8234F54D0AE0DE71CF8EBA0D23032EBDA6059A504E29F244D5CACFC881E4",
	"1865BBFD9B932AD6C3AAC55C9AE713BE3F71926BBC6A25B069D22980F0597BCB",
	"21929C8047A893D41607E395DFEFC1D62094271EC684395DD6E7612300EFD49E",
	"46338953000E052D1B5AB8054D3C8442569B59F82E6B0A53E192D3C3978675E9",
	"E7BD74301E9BBD014A9E2304CA6AF95EF81282482B77145FB786A389C7BCCDA0",
	"46B765B8978836CCE1832A3E358942ECBB96C3643AC52C8EBE30CDDA03463CC7",
	"9647B4C015F9E66892E9811D0157FCBC48E6093F3CCD77DB462F860C4BEC1C3A",
	"9A97259FA17CD8543492FA37142C5D2EB75854B1E43C0F850F11FA98BE916358",
	"CE7763C95C3254D2E4573847F75BA7D0B30DB25C9D9A2D76B2AED7F7C158BE3C",
	"60A0BB71225FAA54A278F6ABF86999E8A6EBD2D53606648FA0E3DBA0794F243C"
	],
	"Superstar Christmas": [
	"7C2FE4719A67918FD27DD1A68E6FA3D6AB2CD2A97276E1BBB9859DEB93D66EA3",
	"0418CB124C97B91BFC919AE416FB5F28AD279E9111BE15E57D5ADA894CBFB591",
	"1711992CD360BF422285CC20D448C04A01BD1157286AF0DEC4F99F2E85075F54",
	"7248CDA13C81A44819545237FF71EE120A0B2E252D4819EC8379545A59AECCC1",
	"596D92CB3C8DB655BCFD012FAE00C454627BE9827E8DF549FA6911474CA84665",
	"58FF6B22FDF0801D2467833E2EEEE0A76AEFD6D42B43C66CF5DDF9138CC3FCF3",
	"02192F50987600608170EB0D3F61F3A0EC4DE24DA6A22C275344C9B7C2C3BC4F",
	"63F280AAF7E0CCEB86299692677112DB56376A3A6997890A9A910AE749C4012E",
	"753CE89C3346EFF8099E9A869E3880F47BEFF1E9D6C86AA8ED1994A7225FC341",
	"A07A77E625D54BC00CD9D30DD27014F2F1E14366B088A4DD9ABD3F8A10F98569",
	"747496B28FA09AD6779091ADCF80DECD34CEAD202CAB1AD003DC29BB39BA164E",
	"A60C35AD4609A6D5D07D880A4841F98A9F6F1F07FB20A4269AB5D30A14121372",
	"F60D6E10AA764EFD9B2919B957540EA677A29CD308897A2F672137A178362909",
	"BCDC82D834DF24071DA5E8976EA223BB73E07A428F02333ADDB3E2411321663B",
	"899ADC7394687E77CE5F00ABBD5F10E76E6B3F2CFCC2DFAF24E1F9F2D1527CE7",
	"F7BEF5380F49B9AFBFBF0FF7F66653BB18BCEA497240370FEE401CB1D1F5FD75",
	"A5B1B8F6AE9EC4F3AC7692DF33AD4854EAE34527E44169B76788EFD84001F288",
	"F134397980E1920895192AA37CE8A377CAAC83CF687E31E06CF7531A5FB435D3",
	"E02EC9C805E5BE4AB170694206F3837E63D6BD26DAEB65BE6AAE9C7BC5236C74",
	"D76FB119C21E092E46729E55902CEABB69C52F1A97C24581E3085B4831984B90"
	]
},
"Michael Bubl√©": {
	"Christmas": [
	"0EE88F0AA1A3A5B751F33782D0E51B7DBADD670513EB31397AA2D73BECCB74D9",
	"0B130B1F16FFB2A69AD393C6F9409EC9B74AD3EC74F9C73F563E14E0387E487C",
	"DB367FE04AA1DFC4942055C7BDF22168894EFA9B6ADE942D3FA65E804A547EE2",
	"5C6EB02361E134C2948B58F090395A8A048B7394BF5D495F68E3151AF3AC24F3",
	"C5AD2AD7A00198BE88437FEFFD13BA467BB2C81F4A53B5F870EB027871FAFC57",
	"974E716F46C3975D6DE67BC39E20D3A443865529B9F5F318735A13EE5A2BEDA7",
	"7B57367272D04C3DEC0B9C396C3B7AC0F8356C0AE52DE52E4C186D476B5EAE95",
	"ECE2A2D466EDD02DF01E750B7EFF2B17E69CF73A1F210F531CB7B4C111B7527E",
	"D795BF9C8CEDCAB78715D6A25CC48C04E02A7B4E2AADA27C449F7163DEFA9299",
	"2EA2AF0964CDABC16A4ADDF98FA53DDFF675FA063B690703020F6DB474004DEF",
	"88A7088AABE8E3884997E79B4F33314E399C828E6590ED25152B1BD499308B60",
	"B2808033A3137C13CF784F6647AC766C40DD41521C92EF6D25129AA1105CB7D7",
	"AFB9F1CD43DAD1A3447AF933C168007E0268A9A5B8D032C4EA9A56F94FAB71CA",
	"EF6157C5A9F2EC8AC052AAF4FE98595F5DEA31A8B43EDB53F0E453757969F91A",
	"BF8DA74B9616459554F96AAECFFB8887DB3B7266AD8E888F9CF217621D476708",
	"73598D6FB207DCB4D00F6D3847D5AC1C1C31C0AD15BD72FE40D21091D52FF3A7"
	]
},
"Howard Shore": {
	"The Hobbit: An Unexpected Journey": [
	"C673E6C7B3E3DC6E9DA84262DAD174B0D6A5ED2B0550C6AFCA1512D02A3DD84A",
	"7D1248A3142018B833D4FEF4445A64D57251827A273B8978552FA7D1575869ED"
	]
}
};