<!DOCTYPE html>
<html lang="en">

	<head>
		<title>DTP Player</title>
		<meta content="text/html; charset=utf-8" http-equiv="Content-Type" />
        <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />

        <style>
            .AudioTrack:hover, .PlaylistEntry:hover {
                cursor: pointer;
                background-color: aquamarine;
            }

            .playing {
                background-color: cornflowerblue;
                color: white;
            }

            fieldset {
                display: inline-block;
                vertical-align: top;
            }

            th {
                text-align: left;
            }

            table {
                display: inline-table;
                border-collapse: separate;
            }

            table:first-of-type {
                border-right: 0.1rem solid grey;
                margin-right: 1rem;
                padding-right: 1rem;
            }

            #Playlist {
                float: right;
                z-index: 999;
                border-style: solid;
                border-width: 0.1rem;
                border-color:grey;
                border-radius: 0.2rem;
                padding: 0.2rem;
            }

            .PlaylistEntry {
                background-color: cornflowerblue;
                color: white;
                padding: 0.1rem;
                margin-bottom: 0.2rem;
            }

            /* tr {
                border-bottom: 0.1rem solid grey;
            } */
        </style>

        <script type="module" src="main.js" ></script>
        
        <script type="module">
            // REPLAY GAIN
            /*
                // Create a MediaElementAudioSourceNode
                // Feed the HTMLMediaElement into it
                var source = audioCtx.createMediaElementSource(AudioTag);

                // Create a gain node
                var gainNode = audioCtx.createGain();
                gainNode.gain.value = desired_gain;

                // connect the AudioBufferSourceNode to the gainNode
                // and the gainNode to the destination
                source.connect(gainNode);
                gainNode.connect(audioCtx.destination);
            */

            // https://developer.mozilla.org/en-US/docs/Web/API/AudioContext/createMediaElementSource
            // https://stackoverflow.com/questions/22604500/web-audio-api-working-with-decibels
            // decibel_level = 20 * Math.log10( gain.value );
            // gain.value = Math.pow(10, (decibel_level / 20));

            // M4A-files
            /*
                These need to be properly fragmented, which most of ours aren't.
                This can be done using mp4fragment (https://www.bento4.com/documentation/mp4fragment/)
                which is a commandline-tool like this:

                mp4fragment --track "audio" "input_file_name.m4a" "output_file_name.m4a"

                https://developer.mozilla.org/en-US/docs/Web/API/Media_Source_Extensions_API/Transcoding_assets_for_MSE
            */

            /* BYTES PER SECOND
                (bitrate * duration) / 8 = size_of_payload
                bitrate / 8 = bytes_per_second
            */

            const UICreateAlbums = function() {
                let output = `<fieldset class="Album">
                    <legend data-album="" >ALBUM 1:</legend>
                    <ol class="AlbumTrackList">
                        <li class="AlbumEntry" >
                            <span data-trackid="XXX" class="AudioTrack">XXX</span>
                            <input data-trackid="XXX" type="checkbox">
                        </li>
                    </ol>
                </fieldset>`;

                let rootElement = document.getElementById("AlbumList");
                let albums = {};

                for (var albumName in albums) {
                    let fieldSet = document.createElement("fieldset");
                    fieldSet.classList.add("Album");
                    
                    let legend = document.createElement("legend");
                    legend.dataset.album = albumName;
                    legend.innerText = albumName;
                    
                    let ol = document.createElement("ol");
                    ol.classList.add("AlbumTrackList");

                    fieldSet.appendChild(legend);
                    fieldSet.appendChild(ol);

                    albums[albumName].forEach(trackID=> {
                        let trackData = MasterAudioTrackIndex[trackID];

                        let li = document.createElement("li");
                        li.classList.add("PlaylistEntry");

                        let span = document.createElement("span");
                        span.classList.add("AudioTrack");
                        span.dataset.trackid = trackID;
                        span.innerText = trackData.Title;

                        let checkbox = document.createElement("input");
                        checkbox.type = "checkbox";
                        checkbox.dataset.trackid = trackID;

                        li.appendChild(checkbox);
                        li.appendChild(span);
                        ol.appendChild(li);
                    });

                    rootElement.appendChild(fieldSet);
                }
            };
        </script>

    </head>

    <body>
        <section id="Playlist">
            <div id="PlaylistHeader">PLAYLIST:</div>
            <hr/>
            <div id="PlaylistBody" ></div>
        </section>

        <button id="UI_Previous">PREVIOUS</button>
        <span>&nbsp;|&nbsp;</span>
        <button id="UI_Play">PLAY</button>
        <button id="UI_Pause">PAUSE</button>
        <button id="UI_Mute">MUTE</button>
        <span>&nbsp;|&nbsp;</span>
        <button id="UI_Next">PREVIOUS</button>

        <p>
            <span id="UI_Volume" >100%</span>
            <span>|</span>
            <input id="UI_Volume_Slider" type="range" min="0.1" max="1.0" step="0.1" value="1.0" />
            <span>|</span>
            <span id="UI_Player_State" >N/A</span> <!--- playing, muted, paused -->
        </p>

        <table>
            <tbody>
                <tr>
                    <th>Play cursor: </th>
                    <td id="UI_PlayCursor">00:00</td>
                </tr>
                <tr>
                    <th>Duration: </th>
                    <td id="UI_Player_Duration">0 | 0</td>
                </tr>
                <tr>
                    <th>Buffered until: </th>
                    <td id="UI_Buffered_Until">00:00</td>
                </tr>
                <tr>
                    <th>Buffered from: </th>
                    <td id="UI_Buffer_Tail">00:00</td>
                </tr>
                <tr>
                    <th>Audio buffer: </th>
                    <td><meter id="UI_Audio_Buffer" high="0" low="0" max="12582912" value="0"></meter> <span id="UI_Audio_Buffer_Limit">0</span></td>
                </tr>
                <tr>
                    <th>Bytes read: </th>
                    <td><progress id="UI_Datastream_Progress" max="0" value="0"></progress> <span id="UI_Datastream_BytesRead">0</span></td>
                </tr>
                <tr>
                    <th>Bytes expected: </th>
                    <td id="UI_Datastream_BytesExpected">0</td>
                </tr>
                <tr>
                    <th>AudioObject state: </th>
                    <td id="UI_AudioObject_State">N/A</td>
                </tr>
                <tr>
                    <th>Datastream state: </th>
                    <td id="UI_Datastream_State">N/A</td>
                </tr>
                <tr>
                    <th>Error: </th>
                    <td id="UI_Error">N/A</td>
                </tr>
            </tbody>
        </table>

        <table>
            <tbody>
                <tr>
                    <th>TrackID: </th>
                    <td id="UI_TrackID">N/A</td>
                </tr>
                <tr>
                    <th>Title: </th>
                    <td id="UI_Title">N/A</td>
                </tr>
                <tr>
                    <th>Album: </th>
                    <td id="UI_Album">N/A</td>
                </tr>
                <!-- <tr>
                    <th>AlbumArtists</th>
                    <td>N/A</td>
                </tr> -->
                <tr>
                    <th>TrackArtists: </th>
                    <td id="UI_TrackArtists">N/A</td>
                </tr>
                <tr>
                    <th>Year: </th>
                    <td id="UI_Year">N/A</td>
                </tr>
                <tr>
                    <th>Genres: </th>
                    <td id="UI_Genres">N/A</td>
                </tr>
                <tr>
                    <th>Duration: </th>
                    <td id="UI_Duration">N/A</td>
                </tr>
                <tr>
                    <th>Mimetype: </th>
                    <td id="UI_Mimetype">N/A</td>
                </tr>
                <tr>
                    <th>Size: </th>
                    <td id="UI_Size">N/A</td>
                </tr>
                <tr>
                    <th>ReplayGain: </th>
                    <td id="UI_ReplayGain">N/A</td>
                </tr>
            </tbody>
        </table>

        <hr/>
        <h2>MUSIC:</h2>

        <section id="AlbumList">
            <fieldset class="Album">
                <legend data-album="" >Devin - Ki: (<span class="AlbumSelectedCount" >0</span>)</legend>

                <a href="javascript:;" class="ToggleAlbum" >HIDE</a>
                <span>&nbsp;|&nbsp;</span>
                <a href="javascript:;" class="SelectAllInAlbum" >ALL</a>
                <span>&nbsp;|&nbsp;</span>
                <a href="javascript:;" class="DeselectAllInAlbum" >NONE</a>

                <ol class="AlbumTrackList" style="display: block;" >
                    <li class="AlbumEntry" >
                        <input data-trackid="589AD74D5E14EC88716B7D90F89C7A93F272DC480EEA8D8BC7010EF26479F072" type="checkbox">
                        <span data-trackid="589AD74D5E14EC88716B7D90F89C7A93F272DC480EEA8D8BC7010EF26479F072" class="AudioTrack">A Monday</span>
                    </li>
                    <li class="AlbumEntry" >
                        <input data-trackid="F45B9A228ECF43A77C3EFBCDDA9C8FC62A35440944CC5B3FB692C6A6C8FB2C00" type="checkbox">
                        <span data-trackid="F45B9A228ECF43A77C3EFBCDDA9C8FC62A35440944CC5B3FB692C6A6C8FB2C00" class="AudioTrack">Aint Never Gonna Win</span>
                    </li>
                    <li class="AlbumEntry" >
                        <input data-trackid="E0A5C0CD65355E75BDC08751F5E81B728C48D90F71E5C8A7448B748C577A8E21" type="checkbox">
                        <span data-trackid="E0A5C0CD65355E75BDC08751F5E81B728C48D90F71E5C8A7448B748C577A8E21" class="AudioTrack">Coast</span>
                    </li>
                    <li class="AlbumEntry" >
                        <input data-trackid="9766E53DF63D4E25C620C0F587F3EDE0DEBA00773EE6E3C163553995274A0EB0" type="checkbox">
                        <span data-trackid="9766E53DF63D4E25C620C0F587F3EDE0DEBA00773EE6E3C163553995274A0EB0" class="AudioTrack">Demon League</span>
                    </li>
                    <li class="AlbumEntry" >
                        <input data-trackid="DFE8C1812BA79BC066E9AA4E0887FB3AD47E00AB1E35C1597948272205535FBD" type="checkbox">
                        <span data-trackid="DFE8C1812BA79BC066E9AA4E0887FB3AD47E00AB1E35C1597948272205535FBD" class="AudioTrack">Disruptr</span>
                    </li>
                    <li class="AlbumEntry" >
                        <input data-trackid="2E9A1046B949E3D0D831C5860C193E210A7BE5CD723666C92BC840DEFB4F97BF" type="checkbox">
                        <span data-trackid="2E9A1046B949E3D0D831C5860C193E210A7BE5CD723666C92BC840DEFB4F97BF" class="AudioTrack">Gato</span>
                    </li>
                    <li class="AlbumEntry" >
                        <input data-trackid="996C51C8C6D40754508B240D041EFD0C11094C0924D413858475CC57A5A457DE" type="checkbox">
                        <span data-trackid="996C51C8C6D40754508B240D041EFD0C11094C0924D413858475CC57A5A457DE" class="AudioTrack">Heaven Send</span>
                    </li>
                    <li class="AlbumEntry" >
                        <input data-trackid="AA5D5F240611DE23A4DB9B7119A3083565B44E8EDC12DC6A6EFD4740C4AF1332" type="checkbox">
                        <span data-trackid="AA5D5F240611DE23A4DB9B7119A3083565B44E8EDC12DC6A6EFD4740C4AF1332" class="AudioTrack">Ki</span>
                    </li>
                    <li class="AlbumEntry" >
                        <input data-trackid="44D5ECC40E357E7C268506636C15C42164B926E39F26FFD6DB278382C127A587" type="checkbox">
                        <span data-trackid="44D5ECC40E357E7C268506636C15C42164B926E39F26FFD6DB278382C127A587" class="AudioTrack">Lady Helen</span>
                    </li>
                    <li class="AlbumEntry" >
                        <input data-trackid="4A294EA6E567F263449CED90535C56D176F8723A0BD9540F9840D9B20A49C380" type="checkbox">
                        <span data-trackid="4A294EA6E567F263449CED90535C56D176F8723A0BD9540F9840D9B20A49C380" class="AudioTrack">Quiet Riot</span>
                    </li>
                    <li class="AlbumEntry" >
                        <input data-trackid="3457A56799540A1253CC808793CCA0CC8BF59C3DFE1067817810868D7E99127B" type="checkbox">
                        <span data-trackid="3457A56799540A1253CC808793CCA0CC8BF59C3DFE1067817810868D7E99127B" class="AudioTrack">Terminal</span>
                    </li>
                    <li class="AlbumEntry" >
                        <input data-trackid="B0931E9BF63171D89B1D986FC9464649D17B76C7B6753834130AEEC686F67294" type="checkbox">
                        <span data-trackid="B0931E9BF63171D89B1D986FC9464649D17B76C7B6753834130AEEC686F67294" class="AudioTrack">Train Fire</span>
                    </li>
                    <li class="AlbumEntry" >
                        <input data-trackid="FBB6FBC6A02A2106B6D01D528774B59111E7912D0157DA3936CEF96A98C14805" type="checkbox">
                        <span data-trackid="FBB6FBC6A02A2106B6D01D528774B59111E7912D0157DA3936CEF96A98C14805" class="AudioTrack">Winter</span>
                    </li>
                </ol>
            </fieldset>
        </section>

        <hr/>
        <section id="LogOutput"></section>
    </body>
</html>